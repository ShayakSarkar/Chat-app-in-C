#include <stdio.h>
#include <stdlib.h>

//This is a dynamic list which can be used for storing 
//any kind of object just like in python. Can be used in
//any kind of project

#define INIT_LEN 2
struct pylist{
	void** arr;
	int index;
	int len;
};

static void pl_init(struct pylist *ptr){
	/*Used to allocate space to the dynamic array
	 */
	ptr->arr=(void**)malloc(sizeof(void*)*INIT_LEN);
	ptr->index=0;
	ptr->len=INIT_LEN;
#undef INIT_LEN
}

static void increase_internal_array(struct pylist* ptr){
	printf("Internal array size increased due to insufficient memory\n");
	int len=ptr->len;
	len=len*2;	// New size is double of previous size
	void** temparr=ptr->arr;
	ptr->arr=(void**)malloc(sizeof(void*)*len);
	for(int i=0;i<len/2;i++){
		ptr->arr[i]=temparr[i];
	}
	ptr->len=len;
	printf("New size is: %d\n",ptr->len);
}

int pl_add(struct pylist *ptr,void* elm){
	if(ptr->index >= ptr->len){
		increase_internal_array(ptr);
	}
	ptr->arr[ptr->index]=elm;
	ptr->len;
	ptr->index++;
	printf("New index: %d\nNew length: %d\n",ptr->index,ptr->len);
	return 0;
}
int pl_delete(struct pylist *ptr,int index){
	if(index>=ptr->index || index<0){
		fprintf(stderr,"Index out of bounds\n");
		return -1;
	}
	for(int i=0;i<index;i++){
	}
	
	free(ptr->arr[index]);

	for(int i=index;i<ptr->index;i++){
		ptr->arr[index]=ptr->arr[index+1];
	}
	free(ptr->arr[ptr->index]);
	ptr->index--;
	printf("New index: %d\nNew length: %d\n",ptr->index,ptr->len);
	return 0;
}

int pl_insert(struct pylist* ptr,void* elm,int index){
	if(index<0 || index>ptr->index){
		fprintf(stderr,"Index out of bounds\n");
		return -1;
	}
	if(ptr->index>ptr->len){
		increase_internal_array(ptr);
	}
	void* temp=ptr->arr[index];
	ptr->arr[index]=elm;
	for(int i=index+1;i<ptr->index;i++){
		void* temp2=ptr->arr[i];
		ptr->arr[i]=temp;
		temp=temp2;
	}
	ptr->index++;
	printf("New index: %d\nNew length: %d\n",ptr->index,ptr->len);
	return 0;
}	

int pl_destroy(struct pylist* ptr){
	for(int i=0;i<ptr->index;i++){
		printf("freed %d\n",i);
		free(ptr->arr+i);
	}
	return 0;
}

void* pl_get(struct pylist* ptr, int index){
	if(index>ptr->index || index<0){
		fprintf(stderr,"Index out of bounds\n");
		return NULL;
	}
	return ptr->arr[index];	
}

